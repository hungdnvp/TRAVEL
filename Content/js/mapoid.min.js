!function(e,t,a,i){var n="mapoid";function s(t,a){this.elem=t,this.$elem=e(t),this.$elem_original=this.$elem,this.options=a,this.metadata=this.$elem.data(),this._init()}s.prototype={defaults:{width:600,strokeColor:"black",strokeWidth:1,fillColor:"black",fillOpacity:.5,fadeTime:500,selectedArea:!1,selectOnClick:!0,click:!1,dblclick:!1,mousedown:!1,mouseup:!1,mouseover:!1,mouseout:!1,mousemove:!1,mouseenter:!1,mouseleave:!1,hoverIn:!1,hoverOut:!1,select:!1,deselect:!1},lang:{textSelectAll:function(){return"Select all"}},_init:function(){this.config=e.extend({},this.defaults,this.options,this.metadata),this.map=this.$elem,this.selectedAreas=[];var i=this,n=i.$elem.attr("name");i.image=e(a).find("img[usemap='#"+n+"']");var s=e("<div class='wrp'></div>");return e("map[name="+n+"]").add("img[usemap='#"+n+"']").wrapAll(s),this.$elem=this.$elem.closest("div"),i.mapHidden=!i.mapIsVisible(),i._onImgLoad(i.image,function(a){i.image.attr("width",a.width),i.image.attr("height",a.height),i._loadMap(),i._initEvents(),e(t).resize(function(){i._reloadAreas()})}),this},_getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},mapIsVisible:function(){return this.map.is(":visible")&&this.image.is(":visible")},_loadMap:function(){var e=this;e._getRandomInt(1,65e3),e._getRandomInt(1,100),e.image.attr("class");e.$elem.css({position:"relative"}),void 0!==e.image.attr("usemap")&&(e._redrawCoords(),e.config.selectedArea&&e._selectAreas(e.config.selectedArea))},_redrawCoords:function(){var t=this,a="coords",i=t.image.attr("width"),n=(t.image.attr("height"),t.image.width()/i*100);t.map.find("area").each(function(){var t=e(this);t.data(a)||t.data(a,t.attr(a));for(var i=t.data(a).split(","),s=new Array(i.length),l=0;l<s.length;++l)s[l]=i[l]*n/100;t.attr(a,s.toString())})},_eventCallback:function(e,t,a){var i=this;if(i.config[e]){var n=a.data("id");return"function"==typeof i.config[e]?i.config[e](t,a,n,i.selectedAreas):console.log(e+" nie je funkcia!"),!0}return!1},_reloadAreasIfHidden:function(){var e=this;e.mapHidden&&(e._reloadAreas(),e.mapHidden=!1)},_reloadAreas:function(){var t=this;if(t.$elem.find("canvas").remove(),!t.mapIsVisible())return t.mapHidden=!0,void console.log("mapa nie je vidiet");t._redrawCoords();t.$elem.find("area.selected").each(function(a,i){e(this).data("id");var n=e(this).hasClass("fixed");t._mapover(e(this),!0,n)})},_initEvents:function(){var t=this;t.map.on("mouseover","area",function(a){t._reloadAreasIfHidden(),t._eventCallback("mouseover",a,e(this)),t._mapover(e(this),!1,!1,!0)}),t.map.on("mouseout","area",function(a){t._eventCallback("mouseout",a,e(this)),t.$elem.find("canvas.temp").fadeOut(t.config.fadeTime)}),t.map.on("click","area",function(a){if(a.preventDefault(),t._eventCallback("click",a,e(this))||t.config.selectOnClick){if(t.config.selectOnClick){var i=parseInt(e(this).data("id")),n=t._inArray(t.selectedAreas,i),s=e(this).hasClass("fixed");n?t._deselectArea(i,!1):t._selectArea(i,s,!1)}}else{var l=e(this).attr("href");l&&(location.href=l)}return!1}),t.map.on("mousedown","area",function(a){t._eventCallback("mousedown",a,e(this))}),t.map.on("mouseup","area",function(a){t._eventCallback("mouseup",a,e(this))}),t.map.on("dblclick","area",function(a){t._eventCallback("dblclick",a,e(this))}),t.map.on("mousemove","area",function(a){t._eventCallback("mousemove",a,e(this))}),t.map.on("mouseenter","area",function(a){t._eventCallback("mouseenter",a,e(this))}),t.map.on("mouseleave","area",function(a){t._eventCallback("mouseleave",a,e(this))}),t.map.find("area").hover(function(a){t._eventCallback("hoverIn",a,e(this))},function(a){t._eventCallback("hoverOut",a,e(this))})},_removeItem:function(e,t){for(var a=0;a<e.length;a++)if(e[a]===t){e.splice(a,1);break}},_inArray:function(e,t){for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1},_onImgLoad:function(e,t){var a=new Image;a.src=!!e[0].getAttribute&&e[0].getAttribute("src")||e[0].src,a.onload=function(){t(a)}},_onMapLoaded:function(e){this.mapIsVisible()&&this._onImgLoad(this.image,function(t){e()})},_mapover:function(t,a,i,n){var s=this,l=parseInt(t.data("id"));isNaN(l)&&(l=s._getRandomInt(1,99999),t.data("id",l)),n&&s.$elem.find("canvas.temp").remove();var o=s.image,r=(o.data("bg_fill"),o.width()),c=o.height(),d=t.attr("shape"),f=e('<canvas data-id="'+l+'" width="'+r+'" height="'+c+'"></canvas>');o.parent().append(f),a?t.addClass("selected"):f.addClass("temp"),i&&t.addClass("fixed");s.$elem.find(".fill").css("background-color"),s.$elem.find(".fill").css("opacity");f.css({width:r+"px",height:c+"px",display:"block",position:"absolute",top:"0px",left:"0px","pointer-events":"none"});var h,m=f[0].getContext("2d"),u=t.attr("coords").split(","),v=[];h=[];for(var p=0;p<u.length;p++)p%2==0?v.push(u[p]):h.push(u[p]);var g=!0,_=t.data("img");s.image.attr("src");if(_&&"poly"==d)g=!1,s._onImgLoad(_,function(e){var t=Math.min.apply(null,v),a=Math.min.apply(null,h),i=Math.max.apply(null,v)-t,n=Math.max.apply(null,h)-a;m.drawImage(e,t,a,i,n),f.hide().fadeIn(s.config.fadeTime)});else{if(m.fillStyle=s.config.fillColor,m.lineWidth=s.config.strokeWidth,m.strokeStyle=s.config.strokeColor,m.globalAlpha=s.config.fillOpacity,"rect"==d)m.fillRect(v[0],h[0],v[1]-v[0],h[1]-h[0]),s.config.strokeWidth>0&&m.strokeRect(v[0],h[0],v[1]-v[0],h[1]-h[0]);else{if(m.beginPath(),"poly"==d){m.moveTo(v[0],h[0]);for(var A=1;A<v.length;A++)m.lineTo(v[A],h[A]);m.closePath()}else"circle"==d&&m.arc(v[0],h[0],v[1],0,2*Math.PI,!0);s.config.fillColor&&m.fill(),s.config.strokeWidth>0&&m.stroke()}g&&f.hide().fadeIn(s.config.fadeTime)}},_selectArea:function(e,t,a){var i=this;e=parseInt(e);var n=i.$elem.find("area[data-id='"+e+"']"),s=n.hasClass("selected"),l=i.$elem.find('canvas[data-id="'+e+'"]');if(i.mapIsVisible()?i._reloadAreasIfHidden():i.mapHidden=!0,s)return console.log("ID "+e+" je uz vybrane!"),!1;!0!==t&&(t=!1),n.length>0?(i.$elem.find('canvas[data-id="'+e+'"]:last').removeClass("temp"),n.addClass("selected"),l.removeClass("temp"),i.selectedAreas.push(e),a&&i._mapover(n,!0,t),i._eventCallback("select",!1,n)):console.log("Plocha s ID "+e+" na mape neexistuje!")},_deselectArea:function(e,t){var a=this;e=parseInt(e);var i=a.$elem.find("area[data-id='"+e+"']"),n=a.$elem.find('canvas[data-id="'+e+'"]'),s=i.hasClass("selected"),l=i.hasClass("fixed");if(!s||l)return!1;i.length>0?(n.addClass("temp"),(n.length>1||t)&&a.$elem.find('canvas[data-id="'+e+'"]:last').fadeOut(a.config.fadeTime),i.removeClass("selected"),a._removeItem(a.selectedAreas,e),a._eventCallback("deselect",!1,i)):console.log("Plocha s ID "+e+" na mape neexistuje!")},_selectAreas:function(e,t,a){var i=this,n=t,s=e.length;function l(e,l,o){setTimeout(function(){i._selectArea(l,o,!0),i._doCallback(e,s,t,a)},n),n+=t}for(var o=0;o<s;o++){var r=parseInt(e[o].id),c=!0===e[o].fixed;t?l(o,r,c):(i._selectArea(r,c,!0),i._doCallback(o,s,t,a))}},_doCallback:function(e,t,a,i){var n=this;e===t-1&&"function"==typeof i&&(a>0?setTimeout(function(){i(n.map,n.selectedAreas)},a):i(n.map,n.selectedAreas))},_deselectAreas:function(e,t,a){var i=this,n=t,s=e.length;function l(e,l){setTimeout(function(){i._deselectArea(l,!0),i._doCallback(e,s,t,a)},n),n+=t}for(var o=0;o<s;o++){var r=parseInt(e[o].id);t?l(o,r):(i._deselectArea(r,!0),i._doCallback(o,s,t,a))}},isSelected:function(e){return!!this._inArray(this.selectedAreas,e)},isFixed:function(e){return!!this.$elem.find("area[data-id='"+e+"']").hasClass("fixed")},getSelected:function(){return this.selectedAreas},getAll:function(){var t=[];return this.$elem.find("area").each(function(a,i){var n=e(this),s=parseInt(n.data("id"));t.push({id:s})}),t},selectOne:function(e,t){var a=this;a._onMapLoaded(function(){a._selectArea(e,t,!0)})},selectAll:function(e,t){var a=this.getAll();this.selectMany(a,e,t)},deselectAll:function(e,t){var a=this.getAll();this.deselect(a,e,t)},selectMany:function(e,t,a){var i=this;i._onMapLoaded(function(){i._selectAreas(e,t,a)})},deselect:function(e,t,a){this._deselectAreas(e,t,a)},removeFixed:function(e){for(var t=0;t<e.length;t++){var a=parseInt(e[t].id),i=this.$elem.find("area[data-id='"+a+"']");this.$elem.find('canvas[data-id="'+a+'"]').remove(),i.removeClass("selected").removeClass("fixed"),this._removeItem(this.selectedAreas,a)}},changeConfig:function(e,t){this.config[e]=t}},e.fn[n]=function(t){var a,l=arguments;return t===i||"object"==typeof t?this.each(function(){e.data(this,"plugin_"+n)||e.data(this,"plugin_"+n,new s(this,t))}):"string"==typeof t&&"_"!==t[0]&&"init"!==t?(this.each(function(){var i=e.data(this,"plugin_"+n);i instanceof s&&"function"==typeof i[t]&&(a=i[t].apply(i,Array.prototype.slice.call(l,1))),"destroy"===t&&e.data(this,"plugin_"+n,null)}),a!==i?a:this):void 0}}(jQuery,window,document);
